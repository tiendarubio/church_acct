<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Misión Pentecostal de Jesucristo — Control de ingresos y egresos</title>

  <!-- Bootstrap & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <!-- Estilos propios -->
  <link href="assets/css/styles.css" rel="stylesheet">

  <!-- Librerías externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-light">

  <!-- NAVBAR SUPERIOR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container-fluid">
      <div class="d-flex flex-column">
        <span class="navbar-brand mb-0 fw-semibold fs-5">
          Misión Pentecostal de Jesucristo
        </span>
        <small class="text-white-50 church-subtitle">
          Control de ingresos y egresos
        </small>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container-fluid py-4">
    <div class="row g-4">

      <!-- COLUMNA IZQUIERDA: RESUMEN + FILTROS -->
      <div class="col-lg-4">
        <!-- Resumen general -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white border-0 pb-1">
            <h5 class="card-title mb-0 d-flex align-items-center gap-2">
              <i class="fa-solid fa-chart-pie text-primary"></i>
              Resumen general
            </h5>
          </div>
          <div class="card-body">
            <p class="mb-2 text-muted small">
              Totales de los movimientos registrados.
            </p>
            <div class="mb-3">
              <div class="summary-label">Total de ingresos:</div>
              <div id="totalIncomes" class="summary-number text-success">
                $0.00
              </div>
            </div>
            <div class="mb-3">
              <div class="summary-label">Total de egresos:</div>
              <div id="totalExpenses" class="summary-number text-danger">
                $0.00
              </div>
            </div>
            <div>
              <div class="summary-label">Saldo:</div>
              <div id="balance" class="summary-number saldo-neutral">
                $0.00
              </div>
            </div>
            <div class="mt-3">
              <span id="filterStatus" class="badge bg-secondary-subtle text-secondary-emphasis small">
                Mostrando todos los movimientos
              </span>
            </div>
          </div>
        </div>

        <!-- Filtros rápidos -->
        <div class="card shadow-sm">
          <div class="card-header bg-white border-0 pb-1">
            <h5 class="card-title mb-0 d-flex align-items-center gap-2">
              <i class="fa-solid fa-filter text-primary"></i>
              Filtros rápidos
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="filterFrom" class="form-label fw-semibold">
                Fecha desde
              </label>
              <input type="date" id="filterFrom" class="form-control form-control-lg">
            </div>
            <div class="mb-3">
              <label for="filterTo" class="form-label fw-semibold">
                Fecha hasta
              </label>
              <input type="date" id="filterTo" class="form-control form-control-lg">
            </div>
            <div class="mb-3">
              <label for="filterText" class="form-label fw-semibold">
                Buscar por evento o descripción
              </label>
              <input
                type="text"
                id="filterText"
                class="form-control form-control-lg"
                placeholder="Ej. Vigilia, campaña, luz, agua..."
              >
            </div>
            <div class="d-flex flex-wrap gap-2">
              <button id="btnApplyFilters" class="btn btn-primary btn-lg flex-fill">
                <i class="fa-solid fa-magnifying-glass me-1"></i>
                Aplicar filtros
              </button>
              <button id="btnClearFilters" class="btn btn-outline-secondary btn-sm">
                Quitar filtros
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- COLUMNA DERECHA: FORMULARIO + TABLA -->
      <div class="col-lg-8">
        <!-- Nuevo movimiento -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white border-0 pb-1">
            <h5 class="card-title mb-0 d-flex align-items-center gap-2">
              <i class="fa-solid fa-hand-holding-dollar text-success"></i>
              Registrar ingreso o egreso
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <!-- Fecha -->
              <div class="col-md-4">
                <label for="dateInput" class="form-label fw-semibold">
                  Fecha <span class="text-danger">*</span>
                </label>
                <input type="date" id="dateInput" class="form-control form-control-lg">
              </div>

              <!-- Evento -->
              <div class="col-md-8">
                <label for="eventInput" class="form-label fw-semibold">
                  Nombre del evento
                  <span class="text-muted small">(opcional)</span>
                </label>
                <input
                  type="text"
                  id="eventInput"
                  class="form-control form-control-lg"
                  placeholder="Ej. Culto general, vigilia, campaña evangelística..."
                >
              </div>

              <!-- Tipo de movimiento -->
              <div class="col-md-6">
                <label class="form-label fw-semibold d-block">
                  Tipo de movimiento <span class="text-danger">*</span>
                </label>
                <div class="btn-group w-100" role="group" aria-label="Tipo de movimiento">
                  <input type="radio" class="btn-check" name="tipoMovimiento" id="btnTipoIngreso" autocomplete="off" value="ingreso">
                  <label class="btn btn-outline-success btn-lg" for="btnTipoIngreso">
                    <i class="fa-solid fa-arrow-down"></i> Ingreso
                  </label>

                  <input type="radio" class="btn-check" name="tipoMovimiento" id="btnTipoEgreso" autocomplete="off" value="egreso">
                  <label class="btn btn-outline-danger btn-lg" for="btnTipoEgreso">
                    <i class="fa-solid fa-arrow-up"></i> Egreso
                  </label>
                </div>
                <div class="form-text">
                  Seleccione si el movimiento es dinero que entra (ingreso) o que sale (egreso).
                </div>
              </div>

              <!-- Categoría -->
              <div class="col-md-6">
                <label for="categorySelect" class="form-label fw-semibold">
                  Categoría <span class="text-danger">*</span>
                </label>
                <select id="categorySelect" class="form-select form-select-lg">
                  <option value="">Seleccione una categoría…</option>
                  <!-- Se llena dinámicamente -->
                </select>
                <div class="form-text">
                  Las categorías se cargan desde la hoja <strong>church_data</strong>.
                </div>
              </div>

              <!-- Monto -->
              <div class="col-md-6">
                <label for="amountInput" class="form-label fw-semibold">
                  Monto en dólares <span class="text-danger">*</span>
                </label>
                <div class="input-group input-group-lg">
                  <span class="input-group-text">$</span>
                  <input
                    type="number"
                    id="amountInput"
                    class="form-control"
                    min="0"
                    step="0.01"
                    placeholder="0.00"
                  >
                </div>
              </div>

              <!-- Descripción -->
              <div class="col-md-6">
                <label for="descriptionInput" class="form-label fw-semibold">
                  Descripción / Detalle
                </label>
                <textarea
                  id="descriptionInput"
                  class="form-control form-control-lg"
                  rows="2"
                  placeholder="Ej. Ofrenda especial, pago de recibo de luz, compra de sillas..."
                ></textarea>
              </div>
            </div>

            <div class="mt-4 d-flex justify-content-end">
              <button id="btnAddMovement" class="btn btn-success btn-lg px-4">
                <i class="fa-solid fa-plus me-1"></i>
                Agregar a la lista
              </button>
            </div>
          </div>
        </div>

        <!-- Movimientos registrados -->
        <div class="card shadow-sm">
          <div class="card-header bg-white border-0">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
              <div>
                <h5 class="card-title mb-0 d-flex align-items-center gap-2">
                  <i class="fa-solid fa-table-list text-primary"></i>
                  Movimientos registrados
                </h5>
                <p class="text-muted small mb-0">
                  Aquí se muestran todos los ingresos y egresos registrados.
                </p>
              </div>
              <div class="btn-toolbar gap-2" role="toolbar">
                <button id="btnSaveCloud" class="btn btn-primary btn-sm" disabled>
                  <i class="fa-solid fa-floppy-disk me-1"></i>
                  Guardar en la nube
                </button>
                <button id="btnExportPDF" class="btn btn-outline-danger btn-sm" disabled>
                  <i class="fa-solid fa-file-pdf me-1"></i>
                  PDF
                </button>
                <button id="btnExportExcel" class="btn btn-outline-success btn-sm" disabled>
                  <i class="fa-solid fa-file-excel me-1"></i>
                  Excel
                </button>
                <button id="btnClearAll" class="btn btn-outline-secondary btn-sm" disabled>
                  <i class="fa-solid fa-trash-can me-1"></i>
                  Limpiar todo
                </button>
              </div>
            </div>
          </div>
          <div class="card-body border-top">
            <div class="table-responsive table-movimientos-wrapper">
              <table class="table table-sm table-bordered align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="text-center" style="width: 48px;">#</th>
                    <th class="text-nowrap">Fecha</th>
                    <th class="text-nowrap">Evento</th>
                    <th class="text-nowrap">Tipo</th>
                    <th class="text-nowrap">Categoría</th>
                    <th class="text-nowrap">Monto</th>
                    <th class="text-nowrap">Descripción</th>
                    <th class="text-center text-nowrap" style="width: 80px;">Acciones</th>
                  </tr>
                </thead>
                <tbody id="movementsBody">
                  <!-- Filas dinámicas -->
                </tbody>
              </table>
            </div>
            <div class="mt-3 small text-muted">
              Los totales del resumen se actualizan automáticamente al agregar, eliminar o filtrar movimientos.
            </div>
          </div>
        </div>
      </div><!-- /col derecha -->
    </div><!-- /row -->
  </main>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script src="assets/js/app-church.js"></script>
  <script src="assets/js/church.js"></script>
</body>
</html>
